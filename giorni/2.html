<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ðŸŽ„ Reindeer Jump</title>

<style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background: #7b0412;
  text-align: center;
  color: #ffd700;
}

h1 {
  margin-top: 12px;
}

canvas {
  margin-top: 20px;
  background: url("../img/sfondo_bosco.jpg") center/cover no-repeat;
  border: 3px solid #ffd700;
  border-radius: 10px;
}
</style>
</head>

<body>
<h1>ðŸŽ„ Reindeer Jump</h1>

<canvas id="game"></canvas>

<script>
/* ============================================================
   ðŸ“± RICONOSCIMENTO DISPOSITIVO
   ============================================================ */
const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);

/* ============================================================
   ðŸŽ® CANVAS RESPONSIVE 4:5
   ============================================================ */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resizeCanvas() {
  const w = window.innerWidth;
  const cw = Math.min(w - 20, 450);
  const ch = cw * 1.25;
  canvas.width = cw;
  canvas.height = ch;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

/* ============================================================
   ðŸ¦Œ RENNA
   ============================================================ */
const rennaImg = new Image();
rennaImg.src = "../img/renna.png";

let renna = {
  x: 40,
  y: canvas.height - 120,
  w: 70,
  h: 70,
  vy: 0,
  jumping: false
};

/* ============================================================
   ðŸŒ² ALBERI â€” VELOCITÃ€ DIVERSA
   ============================================================ */
const alberoImg = new Image();
alberoImg.src = "../img/albero.png";

/* velocitÃ  lenta su telefono, normale su PC */
const OSTACOLO_SPEED = isMobile ? 2.2 : 5.0;

let ostacoli = [];

/* genera alberi */
function generaOstacolo() {
  ostacoli.push({
    x: canvas.width + 20,
    y: canvas.height - 120,
    w: isMobile ? 55 : 70,
    h: isMobile ? 90 : 110
  });
}

/* controllo distanza tra alberi */
let spawnTimer = 0;

/* ============================================================
   ðŸ– CONTROLLI
   ============================================================ */
function salta() {
  if (!renna.jumping) {
    renna.vy = -13;
    renna.jumping = true;
  }
}

/* telefono */
canvas.addEventListener("touchstart", e => {
  e.preventDefault();
  salta();
});

/* browser PC */
window.addEventListener("keydown", e => {
  if (["Space", "ArrowUp"].includes(e.code)) salta();
});
window.addEventListener("mousedown", e => {
  /* click destro, sinistro, touchpad â†’ tutti validi */
  salta();
});

/* ============================================================
   ðŸƒâ€â™‚ GAME LOOP
   ============================================================ */
function gameLoop() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  /* GravitÃ  */
  renna.y += renna.vy;
  renna.vy += 0.6;

  const terreno = canvas.height - 120;
  if (renna.y > terreno) {
    renna.y = terreno;
    renna.vy = 0;
    renna.jumping = false;
  }

  /* disegna renna */
  ctx.drawImage(rennaImg, renna.x, renna.y, renna.w, renna.h);

  /* generazione alberi */
  spawnTimer++;
  if (spawnTimer > (isMobile ? 110 : 70)) {
    generaOstacolo();
    spawnTimer = 0;
  }

  /* movimento + disegno alberi */
  ostacoli.forEach((o, i) => {
    o.x -= OSTACOLO_SPEED;

    ctx.drawImage(alberoImg, o.x, o.y, o.w, o.h);

    /* collisione */
    if (
      renna.x < o.x + o.w &&
      renna.x + renna.w > o.x &&
      renna.y < o.y + o.h &&
      renna.y + renna.h > o.y
    ) {
      alert("Game Over! ðŸ˜­");
      document.location.reload();
    }

    /* rimuovi se fuori schermo */
    if (o.x + o.w < 0) ostacoli.splice(i, 1);
  });

  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>

</body>
</html>
